FINAL PROJECT SUBMISSION LOG
MicroLending Analytics Platform
Generated: 2025-12-15 16:23:41
Students: Saksham Mehta, Jose Lamela, Richard Baah


PART 1: ANALYTICS / REPORTING DATABASE & ETL


REQUIREMENT 1: REPORTING SCHEMA DESIGN
2+ fact tables, 4+ dimension tables, star schema design

>> Fact Tables
+--------------------------------+
| Tables_in_microlending (fact%) |
+--------------------------------+
| fact_daily_portfolio           |
| fact_loan_transactions         |
+--------------------------------+

>> Dimension Tables
+-------------------------------+
| Tables_in_microlending (dim%) |
+-------------------------------+
| dim_currency                  |
| dim_date                      |
| dim_loan_product              |
| dim_loan_status               |
| dim_user                      |
+-------------------------------+

>> fact_loan_transactions Structure
+---------------------+---------------+------+-----+-------------------+-------------------+
| Field               | Type          | Null | Key | Default           | Extra             |
+---------------------+---------------+------+-----+-------------------+-------------------+
| transaction_key     | bigint        | NO   | PRI | NULL              | auto_increment    |
| date_key            | int           | NO   | PRI | NULL              |                   |
| user_key            | int           | NO   | MUL | NULL              |                   |
| product_key         | int           | NO   | MUL | NULL              |                   |
| currency_key        | int           | NO   |     | NULL              |                   |
| status_key          | int           | NO   | MUL | NULL              |                   |
| loan_id             | int           | NO   | MUL | NULL              |                   |
| application_id      | int           | YES  |     | NULL              |                   |
| transaction_type    | varchar(20)   | NO   | MUL | NULL              |                   |
| principal_amount    | decimal(15,2) | NO   |     | NULL              |                   |
| interest_amount     | decimal(15,2) | YES  |     | 0.00              |                   |
| total_amount        | decimal(15,2) | NO   |     | NULL              |                   |
| amount_usd          | decimal(15,2) | NO   |     | NULL              |                   |
| interest_rate       | decimal(5,2)  | YES  |     | NULL              |                   |
| term_months         | int           | YES  |     | NULL              |                   |
| outstanding_balance | decimal(15,2) | YES  |     | NULL              |                   |
| fx_rate             | decimal(15,6) | YES  |     | 1.000000          |                   |
| created_at          | datetime      | YES  |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
+---------------------+---------------+------+-----+-------------------+-------------------+

>> Fact Table Row Counts
+------------------------+-----------+
| table_name             | row_count |
+------------------------+-----------+
| fact_loan_transactions |       432 |
| fact_daily_portfolio   |         3 |
+------------------------+-----------+

>> Dimension Table Row Counts
+------------------+-----------+
| table_name       | row_count |
+------------------+-----------+
| dim_date         |      1096 |
| dim_user         |        90 |
| dim_loan_product |        98 |
| dim_currency     |         5 |
| dim_loan_status  |         8 |
+------------------+-----------+

>> Fact Table Partitioning
+----------------+-------------+
| PARTITION_NAME | range_value |
+----------------+-------------+
| p2024          | 20250101    |
| p2025q1        | 20250401    |
| p2025q2        | 20250701    |
| p2025q3        | 20251001    |
| p2025q4        | 20260101    |
| p_future       | MAXVALUE    |
+----------------+-------------+

>> Sample Fact Data
+-----------------+----------+---------+------------------+------------------+---------------+
| transaction_key | date_key | loan_id | transaction_type | principal_amount | interest_rate |
+-----------------+----------+---------+------------------+------------------+---------------+
|             432 | 20250819 |      27 | origination      |          2112.00 |         10.43 |
|             431 | 20250819 |      27 | origination      |          2112.00 |         10.43 |
|             430 | 20250819 |      27 | origination      |          2112.00 |         10.43 |
|             429 | 20250819 |      27 | origination      |          2112.00 |         10.43 |
|             428 | 20250819 |      27 | origination      |          2112.00 |         10.43 |
+-----------------+----------+---------+------------------+------------------+---------------+

>> dim_user (SCD Type 2)
+----------+---------+--------------------------+----------+-------------+------------+
| user_key | user_id | email                    | role     | credit_tier | is_current |
+----------+---------+--------------------------+----------+-------------+------------+
|        1 |       1 | john.doe@email.com       | borrower | Good        |          1 |
|        2 |       2 | jane.smith@email.com     | borrower | Good        |          1 |
|        3 |       3 | mike.brown@email.com     | borrower | Good        |          1 |
|        4 |       4 | bob.johnson@email.com    | lender   | Excellent   |          1 |
|        5 |       5 | alice.williams@email.com | lender   | Excellent   |          1 |
+----------+---------+--------------------------+----------+-------------+------------+

>> dim_loan_status
+------------+-------------+----------------+-----------------+-------------+---------------+
| status_key | status_code | status_name    | status_category | is_terminal | display_order |
+------------+-------------+----------------+-----------------+-------------+---------------+
|          1 | pending     | Pending Review | application     |           0 |             1 |
|          2 | approved    | Approved       | application     |           0 |             2 |
|          3 | rejected    | Rejected       | application     |           1 |             3 |
|          4 | withdrawn   | Withdrawn      | application     |           1 |             4 |
|          5 | active      | Active         | loan            |           0 |             5 |
|          6 | paid_off    | Paid Off       | loan            |           1 |             6 |
|          7 | defaulted   | Defaulted      | loan            |           1 |             7 |
|          8 | cancelled   | Cancelled      | loan            |           1 |             8 |
+------------+-------------+----------------+-----------------+-------------+---------------+


REQUIREMENT 2: THREE SOURCE SYSTEMS
ETL extracts from Transaction DB, Reference Data, Market Data

>> Source 1 - Transaction Database (OLTP)
+------------------+-----------+
| table_name       | row_count |
+------------------+-----------+
| user             |        10 |
| loan             |        27 |
| loan_application |        27 |
| wallet_account   |         6 |
+------------------+-----------+

>> Source 2 - Reference Data
+------------------+-----------+
| table_name       | row_count |
+------------------+-----------+
| ref_currency     |         9 |
| ref_loan_product |        10 |
| ref_region       |        14 |
| ref_credit_tier  |         5 |
+------------------+-----------+

>> Source 3 - Market Data
+----------------------------+-----------+
| table_name                 | row_count |
+----------------------------+-----------+
| market_fx_rates            |        13 |
| market_interest_benchmarks |        12 |
| market_credit_spreads      |        16 |
+----------------------------+-----------+

>> Sample FX Rates
+---------------+----------------+------------+------------+
| base_currency | quote_currency | rate       | rate_date  |
+---------------+----------------+------------+------------+
| USD           | GBP            |   0.789100 | 2025-12-01 |
| USD           | BRL            |   4.978000 | 2025-12-01 |
| USD           | INR            |  83.420000 | 2025-12-01 |
| USD           | JPY            | 149.850000 | 2025-12-01 |
| USD           | EUR            |   0.923400 | 2025-12-01 |
+---------------+----------------+------------+------------+

>> Sample Interest Benchmarks
+----------------+--------+----------------+-------------+
| benchmark_code | rate   | effective_date | term_months |
+----------------+--------+----------------+-------------+
| TREASURY_1Y    | 4.8500 | 2025-12-01     |          12 |
| LIBOR_3M       | 5.5800 | 2025-12-01     |           3 |
| LIBOR_6M       | 5.7100 | 2025-12-01     |           6 |
| LIBOR_1M       | 5.4200 | 2025-12-01     |           1 |
| TREASURY_2Y    | 4.4200 | 2025-12-01     |          24 |
+----------------+--------+----------------+-------------+


REQUIREMENT 3: ETL PIPELINE DESIGN
Full load, incremental load with watermarks, bulk loading

>> ETL Control Tables
+-------------------------------+
| Tables_in_microlending (etl%) |
+-------------------------------+
| etl_error_log                 |
| etl_run_log                   |
| etl_staging_loan              |
| etl_step_log                  |
| etl_watermarks                |
+-------------------------------+

>> ETL Watermarks
+----------------+----------------------------+-------------+---------------------+
| source_name    | table_name                 | column_name | watermark_value     |
+----------------+----------------------------+-------------+---------------------+
| market_db      | market_credit_spreads      | created_at  | 1970-01-01 00:00:00 |
| market_db      | market_fx_rates            | created_at  | 1970-01-01 00:00:00 |
| market_db      | market_interest_benchmarks | created_at  | 1970-01-01 00:00:00 |
| reference_db   | ref_credit_tier            | created_at  | 1970-01-01 00:00:00 |
| reference_db   | ref_currency               | created_at  | 1970-01-01 00:00:00 |
| reference_db   | ref_loan_product           | created_at  | 1970-01-01 00:00:00 |
| reference_db   | ref_region                 | created_at  | 1970-01-01 00:00:00 |
| transaction_db | loan                       | updated_at  | 2025-12-03 02:02:08 |
| transaction_db | loan_application           | updated_at  | 2025-11-11 04:54:30 |
| transaction_db | repayment_schedule         | updated_at  | 2025-12-15 18:49:13 |
| transaction_db | transaction_ledger         | created_at  | 2024-03-16 10:00:00 |
| transaction_db | user                       | updated_at  | 2025-10-30 16:20:16 |
| transaction_db | wallet_account             | updated_at  | 1970-01-01 00:00:00 |
+----------------+----------------------------+-------------+---------------------+

>> Recent ETL Runs
+--------+----------+---------+----------------+------------------+-------------+---------------------+
| run_id | run_type | status  | rows_extracted | rows_transformed | rows_loaded | started_at          |
+--------+----------+---------+----------------+------------------+-------------+---------------------+
|   9999 |          | running |              0 |                0 |           0 | 2025-12-15 20:20:31 |
|   9998 |          | running |              0 |                0 |           0 | 2025-12-15 20:20:31 |
|   9997 |          | running |              0 |                0 |           0 | 2025-12-15 20:20:31 |
+--------+----------+---------+----------------+------------------+-------------+---------------------+

>> ETL Step Details
+-----------------------+-----------+---------+----------------+------------------+
| step_name             | step_type | status  | rows_processed | duration_seconds |
+-----------------------+-----------+---------+----------------+------------------+
| recovery_step         | load      | success |             50 |             0.00 |
| failing_step          | load      | failed  |            100 |             0.00 |
| check_duplicates      | validate  |         |              5 |             0.00 |
| validate_data_quality | validate  |         |              5 |             0.00 |
| validate_loan_refs    | validate  |         |              4 |             0.20 |
+-----------------------+-----------+---------+----------------+------------------+

>> Bulk Load Performance
+---------------+----------------+------------------+--------------+
| step_name     | rows_processed | duration_seconds | rows_per_sec |
+---------------+----------------+------------------+--------------+
| recovery_step |             50 |             0.00 |         NULL |
| failing_step  |            100 |             0.00 |         NULL |
| recovery_step |             50 |             0.00 |         NULL |
+---------------+----------------+------------------+--------------+


REQUIREMENT 4: STORED PROCEDURES WITH ERROR HANDLING
SPs return status/error messages, surface validation failures

>> ETL Stored Procedures
+-----------------------------------+
| ROUTINE_NAME                      |
+-----------------------------------+
| sp_etl_load_fact_transactions     |
| sp_etl_refresh_portfolio_snapshot |
| sp_etl_validate_loan              |
| sp_etl_validate_staging           |
+-----------------------------------+

>> Validation - Valid Record
+----------+------------+---------+
| is_valid | error_code | message |
+----------+------------+---------+
|        1 | NULL       | NULL    |
+----------+------------+---------+

>> Validation - Invalid Interest Rate (150%)
+----------+--------------+-----------------------------------------+
| is_valid | error_code   | message                                 |
+----------+--------------+-----------------------------------------+
|        0 | INVALID_RATE | Interest rate must be between 0 and 100 |
+----------+--------------+-----------------------------------------+

>> Validation - Invalid Borrower (ID 99999)
+----------+------------------+----------------------------------+
| is_valid | error_code       | message                          |
+----------+------------------+----------------------------------+
|        0 | INVALID_BORROWER | Borrower ID 99999 does not exist |
+----------+------------------+----------------------------------+

>> ETL Error Log Schema
+------------------+--------------+------+-----+-------------------+-------------------+
| Field            | Type         | Null | Key | Default           | Extra             |
+------------------+--------------+------+-----+-------------------+-------------------+
| error_id         | int          | NO   | PRI | NULL              | auto_increment    |
| run_id           | int          | NO   | MUL | NULL              |                   |
| step_id          | int          | YES  | MUL | NULL              |                   |
| error_type       | varchar(50)  | NO   | MUL | NULL              |                   |
| error_code       | varchar(20)  | YES  |     | NULL              |                   |
| severity         | varchar(20)  | YES  |     | ERROR             |                   |
| process_name     | varchar(50)  | YES  |     | etl               |                   |
| error_message    | text         | NO   |     | NULL              |                   |
| source_table     | varchar(100) | YES  |     | NULL              |                   |
| source_record_id | varchar(100) | YES  |     | NULL              |                   |
| error_data       | json         | YES  |     | NULL              |                   |
| stack_trace      | text         | YES  |     | NULL              |                   |
| correlation_id   | varchar(50)  | YES  |     | NULL              |                   |
| created_at       | datetime     | NO   |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
+------------------+--------------+------+-----+-------------------+-------------------+

>> Processing Metrics
+--------+----------+----------------+-------------+---------------+--------------+
| run_id | run_type | rows_extracted | rows_loaded | duration_secs | rows_per_sec |
+--------+----------+----------------+-------------+---------------+--------------+
|   9999 |          |              0 |           0 |          NULL |         NULL |
|   9998 |          |              0 |           0 |          NULL |         NULL |
|   9997 |          |              0 |           0 |          NULL |         NULL |
+--------+----------+----------------+-------------+---------------+--------------+


REQUIREMENT 5: DATA QUALITY CHECKS
Null checks, range validation, referential integrity

>> Null Value Check
+------------------------+-----------------+
| check_item             | violation_count |
+------------------------+-----------------+
| loan.borrower_id nulls |               0 |
| loan.principal nulls   |               0 |
| user.email nulls       |               0 |
+------------------------+-----------------+

>> Range Validation
+---------------------+-----------------+
| violation           | violation_count |
+---------------------+-----------------+
| interest_rate > 100 |               0 |
| principal <= 0      |               0 |
| term_months <= 0    |               0 |
+---------------------+-----------------+

>> Referential Integrity
+------------------------+-----------------+
| check_item             | violation_count |
+------------------------+-----------------+
| orphan loans (no user) |               0 |
+------------------------+-----------------+


REQUIREMENT 6: ANALYTICAL QUERIES
Star schema joins and aggregations

>> Loan Distribution by Status
+-------------+------------+-----------------+----------+
| status_name | loan_count | total_principal | avg_rate |
+-------------+------------+-----------------+----------+
| Active      |        192 |      1101824.00 |     9.36 |
| Defaulted   |         96 |       507744.00 |     9.43 |
| Cancelled   |         96 |       452640.00 |    10.36 |
| Paid Off    |         48 |       358096.00 |    12.25 |
+-------------+------------+-----------------+----------+

>> Portfolio by Month
+------+-------+------------+--------------+-----------+
| year | month | month_name | transactions | volume    |
+------+-------+------------+--------------+-----------+
| 2025 |    10 | October    |           32 | 134496.00 |
| 2025 |     9 | September  |           32 | 139376.00 |
| 2025 |     8 | August     |          176 | 878352.00 |
| 2025 |     7 | July       |           64 | 347312.00 |
| 2025 |     6 | June       |           96 | 680768.00 |
| 2024 |     1 | January    |           32 | 240000.00 |
+------+-------+------------+--------------+-----------+

>> Daily Portfolio Snapshot
+----------+-------------+--------------+-----------------+--------------+---------------+
| date_key | total_loans | active_loans | total_principal | default_rate | avg_loan_size |
+----------+-------------+--------------+-----------------+--------------+---------------+
| 20251215 |          27 |           12 |       151269.00 |       0.2222 |       5602.56 |
| 20251205 |          27 |           12 |       151269.00 |       0.2222 |       5602.56 |
| 20251203 |          27 |           12 |       151269.00 |       0.2222 |       5602.56 |
+----------+-------------+--------------+-----------------+--------------+---------------+



PART 2: REDIS CACHE & GUI CLIENT


REQUIREMENT 7: REDIS UNDER DOCKER

>> Docker Container Status
NAMES                IMAGE            STATUS                   PORTS
microlending-redis   redis:7-alpine   Up 2 minutes (healthy)   0.0.0.0:6379->6379/tcp, [::]:6379->6379/tcp

>> Redis Ping
PONG

>> Redis Version
redis_version:7.4.7

>> Docker Compose Config
version: '3.8'

services:
  redis:
    image: redis:7-alpine
    container_name: microlending-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 3
    restart: unless-stopped

volumes:
  redis_data:
    driver: local


REQUIREMENT 8: CACHE-ASIDE PATTERN
On miss load from DB, on hit serve from cache

>> Clear Cache: redis-cli FLUSHDB
OK

>> First Request (Cache Miss)
cached: False, items: 9, ttl: 3600s

>> Second Request (Cache Hit)
cached: True, items: 9

>> Verify Redis Keys
ml:reference:currencies


REQUIREMENT 9: CACHE INVALIDATION

>> Invalidate Reference Cache
{"invalidated":1}

>> Verify Cache Cleared


>> Re-fetch After Invalidation
cached: False (fresh from DB), items: 9


REQUIREMENT 10: LOOK-AHEAD CACHING
Pre-cache adjacent pages for smooth scrolling

>> Request Page 1 (Triggers Look-Ahead)
cached: False, page: 1, has_next: True, rows: 10

>> Verify Look-Ahead Pre-cached Page 2
ml:transactions:p1:s10:stall:ball
ml:transactions:p2:s10:stall:ball

>> Request Page 2 (Cache Hit from Look-Ahead)
cached: True, page: 2


REQUIREMENT 11: CACHE TELEMETRY
TTL, memory usage, hit/miss stats

>> TTL on Reference Data (1 hour)
3600

>> TTL on Transaction Pages (5 min)
Key: ml:transactions:p1:s10:stall:ball, TTL: 300

>> Redis Memory Usage
used_memory_human:1.33M
used_memory_peak_human:1.35M

>> Cache Hit/Miss Stats
keyspace_hits:6
keyspace_misses:4


REQUIREMENT 12: PERSISTED CACHE METRICS

>> Current Metrics
Hits: 2, Misses: 3, Hit Ratio: 40.0%
Avg Cache: 1.0ms, Avg DB: 233.21ms, Speedup: 233.21x

>> Persisted Metrics Keys
ml:metrics:misses:minute:202512151623
ml:metrics:hits:minute:202512151623
ml:metrics:hits:hour:2025121516
ml:metrics:misses:hour:2025121516
ml:metrics:latency:db:202512151623
ml:metrics:misses:total
ml:metrics:latency:cache:202512151623
ml:metrics:invalidations:total
ml:metrics:invalidations:minute:202512151623
ml:metrics:hits:total

>> Hit Counts by Operation
reference:currencies
1
transactions
1

>> Miss Counts by Operation
reference:currencies
2
transactions
1


REQUIREMENT 13: GRACEFUL FALLBACK
Application continues working when Redis is unavailable.
Test: docker-compose stop redis && curl http://localhost:8000/cache/reference/currencies


END OF LOG
